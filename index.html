<!DOCTYPE html>
<html lang="pl">
<head>
    <meta charset="UTF-8">
    <title>Elite Buzzer League</title>
    <link rel="stylesheet" href="css/style.css">
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <style>
        /* Styl dla zakadek Admina */
        .admin-nav { display: flex; gap: 5px; padding: 0 20px; margin-top: 15px; }
        .btn-tab { 
            padding: 10px 20px; border: none; background: #ddd; cursor: pointer; 
            border-radius: 8px 8px 0 0; font-weight: bold; transition: 0.3s;
        }
        .btn-tab.active { background: #e65100; color: white; }
        .admin-tab-content { display: none; margin: 0 20px 20px 20px; border-radius: 0 10px 10px 10px; }
        .admin-tab-content.active { display: block; }
        
        /* Tabela zawodnik贸w */
        .admin-table { width: 100%; border-collapse: collapse; background: white; margin-top: 10px; }
        .admin-table th, .admin-table td { border: 1px solid #ddd; padding: 10px; text-align: left; font-size: 13px; }
        .admin-table th { background: #f2f2f2; }

        /* DRAFT LOTTERY STYLES */
        #draft-lottery-screen {
            display: none;
            position: fixed;
            top: 0; left: 0; width: 100%; height: 100%;
            background: radial-gradient(circle, #1a237e 0%, #000010 100%);
            z-index: 9999;
            color: white;
            overflow-y: auto;
            padding: 40px 20px;
        }
        .lottery-container { max-width: 900px; margin: 0 auto; text-align: center; }
        .machine-ball {
            width: 120px; height: 120px; background: #ff6d00; border-radius: 50%;
            margin: 20px auto; display: flex; align-items: center; justify-content: center;
            font-size: 50px; box-shadow: 0 0 30px rgba(255,109,0,0.5);
            animation: bounce 0.5s infinite alternate;
        }
        @keyframes bounce { from { transform: translateY(0); } to { transform: translateY(-10px); } }
        
        .results-grid {
            display: grid; grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
            gap: 15px; margin-top: 30px;
        }
        .envelope {
            background: #283593; border: 2px solid #3f51b5; padding: 15px;
            border-radius: 5px; font-weight: bold; transition: all 0.5s;
            text-transform: uppercase; letter-spacing: 1px;
        }
        .envelope.revealed {
            background: white; color: #1a237e; border-color: #ff6d00;
            transform: scale(1.05); box-shadow: 0 0 15px rgba(255,255,255,0.3);
        }
        .exit-lottery {
            margin-top: 40px; padding: 10px 20px; background: transparent;
            border: 1px solid white; color: white; cursor: pointer;
        }
    </style>
</head>
<body>

<div id="landing-page">
    <header>
        <h1 style="color:var(--nba-orange); margin:0" data-i18n="welcome_title">ELITE BUZZER LEAGUE</h1>
        
        <div class="lang-switcher">
            <img src="https://flagcdn.com/w40/pl.png" id="lang-pl-landing" onclick="setLanguage('pl')" class="lang-flag" alt="PL">
            <span class="lang-divider">|</span>
            <img src="https://flagcdn.com/w40/us.png" id="lang-en-landing" onclick="setLanguage('en')" class="lang-flag" alt="EN">
        </div>
    </header>

    <div class="hero-container">
        <img src="https://images.unsplash.com/photo-1546519638-68e109498ffc?w=400" class="hero-img">
        <img src="https://images.unsplash.com/photo-1519861531473-920036214751?w=400" class="hero-img">
    </div>

    <div class="auth-card">
        <h2 data-i18n="login_header">Panel Managera</h2>
        <input type="email" id="email" placeholder="Email">
        <input type="password" id="password" placeholder="Haso">
        <button class="btn" onclick="signIn()" data-i18n="btn_login">ZALOGUJ SI</button>
        <button class="btn" style="background:#555; margin-top:10px;" onclick="signUp()" data-i18n="btn_signup">ZA呕 KONTO</button>
    </div>
</div>

<div id="game-app" style="display:none;">
    <header>
        <div class="header-left">
            <div class="logo-container" onclick="location.reload()" style="cursor: pointer;">
                <img src="logo_EBL.png" alt="Logo" class="main-logo" id="main-logo-img">
            </div>
            <div class="league-name-text" style="font-weight:bold; color:var(--nba-blue); font-size: 1.2rem;" data-i18n="welcome_title">ELITE BUZZER LEAGUE</div>
        </div>
        
        <div class="header-right">
            <div id="user-info-display" class="user-info"></div>
            
            <div class="lang-switcher">
                <img src="https://flagcdn.com/w40/pl.png" id="lang-pl" onclick="setLanguage('pl')" class="lang-flag" alt="PL">
                <span class="lang-divider">|</span>
                <img src="https://flagcdn.com/w40/us.png" id="lang-en" onclick="setLanguage('en')" class="lang-flag" alt="EN">
            </div>

            <button onclick="logout()" class="btn-logout" data-i18n="logout">Wyloguj</button>
        </div>
    </header>

    <div id="admin-panel" style="display:none;">
        <div class="admin-nav">
            <button class="btn-tab active" onclick="showAdminTab('gen')">Generowanie</button>
            <button class="btn-tab" onclick="showAdminTab('config')">Potencjay i Skille</button>
            <button class="btn-tab" onclick="showAdminTab('media')">Media</button>
            <button class="btn-tab" onclick="showAdminTab('players')">Baza Zawodnik贸w</button>
        </div>

        <div id="admin-tab-gen" class="admin-tab-content active" style="padding:20px; background:#fff3e0; border: 1px solid #ffe0b2;">
            <h3 data-i18n="admin_panel" style="margin-top:0; color:#e65100;">Generator wiata</h3>
            <p style="font-size: 14px;" data-i18n="admin_desc">Witaj, Szefie. Wygeneruj zawodnik贸w do Draftu lub uruchom loteri.</p>
            <div style="display:flex; gap:10px;">
                <button class="btn" onclick="initWorld()" style="flex:1;">GENERUJ WIAT I LIGI</button>
                <button class="btn" onclick="startLotteryShow()" style="flex:1; background:#1a237e;">URUCHOM LOTERI DRAFTU</button>
            </div>
        </div>

        <div id="admin-tab-config" class="admin-tab-content" style="padding:20px; background:#e3f2fd; border: 1px solid #bbdefb;">
            <h3 style="margin-top:0;">Edytor Nazewnictwa</h3>
            <div style="display:flex; gap:20px; flex-wrap: wrap;">
                <div style="flex:1; min-width:300px;">
                    <label>Wybierz element do edycji:</label>
                    <select id="config-type-select" class="btn" style="background:white; color:black; margin-top:5px;" onchange="loadConfigList()">
                        <option value="">-- Wybierz kategori --</option>
                        <option value="potential">Potencjay (BuzzerBeater)</option>
                        <option value="skill">Umiejtnoci (Skille)</option>
                    </select>
                    <div id="config-list-container" style="margin-top:15px; display:none;">
                        <select id="config-item-select" class="btn" style="background:white; color:black;" onchange="showConfigEditor()"></select>
                    </div>
                </div>
                <div id="config-editor-fields" style="flex:1; min-width:300px; display:none; background:white; padding:15px; border-radius:8px;">
                    <h4 id="edit-item-title" style="margin-top:0;">Edytuj</h4>
                    <label>Nazwa PL:</label><br>
                    <input type="text" id="edit-name-pl" style="width:100%; margin-bottom:10px;"><br>
                    <label>Nazwa EN:</label><br>
                    <input type="text" id="edit-name-en" style="width:100%; margin-bottom:10px;">
                    <button class="btn" onclick="saveGameConfig()">ZAPISZ ZMIANY</button>
                </div>
            </div>
        </div>

        <div id="admin-tab-media" class="admin-tab-content" style="padding:20px; background:#f5f5f5; border: 1px solid #ddd;">
            <h4 style="margin-top:0;">Zarzdzanie wizualne (Logo & Hero)</h4>
            <div style="display: flex; flex-direction: column; gap: 10px; max-width: 500px;">
                <input type="text" id="hero-img-1-url" placeholder="Link do zdjcia Hero 1">
                <input type="text" id="hero-img-2-url" placeholder="Link do zdjcia Hero 2">
                <input type="text" id="logo-url-input" placeholder="Link do Twojego Logo">
                <button class="btn" style="background: #333;" onclick="adminUpdateMedia()">ZAPISZ ZMIANY MEDIW</button>
            </div>
        </div>

        <div id="admin-tab-players" class="admin-tab-content" style="padding:20px; background:#eceff1; border: 1px solid #cfd8dc;">
            <h3 style="margin-top:0;">Globalna Lista Zawodnik贸w</h3>
            <div style="display:flex; gap:10px; margin-bottom:15px; flex-wrap:wrap;">
                <select id="filter-season" class="btn" style="background:white; color:black; width:auto;"><option value="1">Sezon 1</option></select>
                <select id="filter-country" class="btn" style="background:white; color:black; width:auto;"><option value="all">Wszystkie Kraje</option></select>
                <select id="filter-league" class="btn" style="background:white; color:black; width:auto;"><option value="all">Wszystkie Ligi</option></select>
                <button class="btn" onclick="fetchAdminPlayersList()" style="width:auto; background:#455a64;">FILTRUJ</button>
            </div>
            <div id="admin-players-table" style="overflow-x:auto;">
                <p>U偶yj filtr贸w, aby zaadowa zawodnik贸w...</p>
            </div>
        </div>
    </div>

    <div id="main-content" style="padding:20px;"></div>
</div>

<div id="draft-lottery-screen">
    <div class="lottery-container">
        <h1 style="color:#ff6d00; margin-bottom:10px;">DRAFT LOTTERY STUDIO</h1>
        <p id="lottery-status">Czekamy na oficjalne wyniki...</p>
        
        <div class="machine-ball"></div>
        
        <div id="lottery-results" class="results-grid">
            </div>

        <div style="margin-top:40px;">
            <button id="next-pick-btn" class="btn" style="background:#ff6d00; padding:15px 40px; font-size:18px;">
                OTWRZ KOLEJN KOPERT
            </button>
        </div>
        
        <button class="exit-lottery" onclick="document.getElementById('draft-lottery-screen').style.display='none'">
            ZAMKNIJ STUDIO (PO POWROCIE)
        </button>
    </div>
</div>

<script src="js/lang.js"></script>
<script src="js/auth.js"></script>
<script src="js/world_gen.js"></script>
<script src="js/setup_team.js"></script> 
<script src="js/roster.js"></script>
<script src="js/admin.js"></script>
<script src="js/draft.js"></script>

<script>
    function showAdminTab(tabName) {
        document.querySelectorAll('.admin-tab-content').forEach(tab => tab.classList.remove('active'));
        document.querySelectorAll('.btn-tab').forEach(btn => btn.classList.remove('active'));
        
        document.getElementById('admin-tab-' + tabName).classList.add('active');
        event.currentTarget.classList.add('active');
    }

    // Funkcje UI dla Loterii (mo偶esz przenie do js/draft.js)
    let currentDraftOrder = [];
    let revealIndex = 0;

    async function startLotteryShow() {
        // 1. Poka偶 ekran
        document.getElementById('draft-lottery-screen').style.display = 'block';
        const resultsContainer = document.getElementById('lottery-results');
        resultsContainer.innerHTML = '<p>Losowanie kulek...</p>';
        
        // 2. Pobierz dane z draft.js
        currentDraftOrder = await runLeagueLottery('PLK'); // U偶ywamy Twojej funkcji z pkt 1
        
        // 3. Przygotuj "zamknite" koperty (od 20 do 1)
        resultsContainer.innerHTML = '';
        revealIndex = currentDraftOrder.length - 1; // Zaczynamy od koca (Pick 20)

        for(let i=0; i < currentDraftOrder.length; i++) {
            resultsContainer.innerHTML += `<div id="env-${i}" class="envelope">Pick #${i+1}</div>`;
        }
        document.getElementById('lottery-status').innerText = "Wszystkie koperty s gotowe. Zaczynamy od Picku #20!";
    }

    document.getElementById('next-pick-btn').onclick = () => {
        if(revealIndex < 0) {
            alert("To by numer 1! Draft Lottery Sezonu zakoczony.");
            return;
        }

        const team = currentDraftOrder[revealIndex];
        const env = document.getElementById(`env-${revealIndex}`);
        
        env.classList.add('revealed');
        env.innerHTML = `<span>PICK #${revealIndex+1}</span><br><small>${team.name}</small>`;
        
        document.getElementById('lottery-status').innerText = `Odkryto Pick #${revealIndex+1}: ${team.name}`;
        
        revealIndex--;
    };
</script>

</body>
</html>
